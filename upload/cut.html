<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <link rel="stylesheet" type="text/css" href="./css/imgareaselect-default.css" />
    <script type="text/javascript" src="./scripts/jquery.min.js"></script>
    <script type="text/javascript" src="./scripts/jquery.imgareaselect.pack.js"></script>
    <script type="text/javascript">
        function preview(img, selection) {
            $('#selectbanner').data('x',selection.x1);
            $('#selectbanner').data('y',selection.y1);
            $('#selectbanner').data('w',selection.width);
            $('#selectbanner').data('h',selection.height);

            var scaleX = 100 / (selection.width || 1);
            var scaleY = 100 / (selection.height || 1);
            $('#ferret > img').css({
                width: Math.round(scaleX * 512) + 'px',//512、390是你上传图片的宽高
                height: Math.round(scaleY * 390) + 'px',
                marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
                marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
            });
        }

        //这里通过jQuery语法在原来图片后插入预览的小图片
        $(document).ready(function () {
            $('<div id="ferret"><img src="./xx.jpg" style="position:relative;"/></div>').css({
                float: 'left',
                position: 'relative',
                overflow: 'hidden',
                width: '100px',
                height: '100px'
            }).insertAfter($('#selectbanner'));

            $('#selectbanner').imgAreaSelect({
                selectionColor: 'blue', x1:0, y1:0, x2: 100,//初始位置
                maxWidth:500,y2:100,
                aspectRatio: '1:1',//缩放比例
                selectionOpacity: 0.2 ,
                onSelectEnd: preview //裁剪后执行的函数，在上面
            });
//确认裁剪 
            $("#sliceButton").click(function() {
                var pic = $('#selectbanner').attr('src');
// alert(pic); 
                var x,y,w,h;
                $.post(
                    "cat.php", //（2）将附上这个页面的代码
                    {
                        x:$('#selectbanner').data('x'),
                        y:$('#selectbanner').data('y'),
                        w:$('#selectbanner').data('w'),
                        h:$('#selectbanner').data('h'),
                        pic:pic
                    },
                    function(data){
// alert(data); 
//把裁剪后图片加载到#sure 
                        if(data){
                            $('#sure').attr('src',data);
                        }
                    }
                );
            });
        })
    </script>
    <title>图片裁剪、预览</title>
</head>
<body>

<div id="s">
    <!--上传图片-->
    <form action="" method="post" enctype="multipart/form-data">
        <input type="file" id="img" name="img" value="" onclick=""/>
        <input name="submit" id="submit" type="submit" value="提交" class="submit"/>
    </form>
    <!--显示图片-->
    <?php if(isset($_SESSION['upfile'])){?>
    <img id="selectbanner" name="selectbanner" src="<? echo $_SESSION['upfile'];?>" title="mypic"/>
    <?php }?>
</div>
<!--确认裁剪-->
<div><input type="submit" id="sliceButton" name="sliceButton" value="sliceButton"></div>
<!--显示裁剪后的图片-->
<div><img id="sure" src="" style="cursor:hand" /></div>
</body>
</html> 